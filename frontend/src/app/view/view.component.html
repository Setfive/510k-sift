<div class="container my-5" *ngIf="loading">
  <div class="text-center">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
</div>

<div *ngIf="!loading" class="container my-5">
  <div class="row">
    <div class="col-8">
      <div class="card">
        <div class="card-header" [innerHTML]="device?.knumber"></div>
        <div class="card-body">
          <p>
            <strong>510(k) Number:</strong><br>
            {{ device?.knumber }}
          </p>
          <p>
            <strong>Device Name:</strong><br>
            {{ device?.deviceName }}
          </p>
          <p>
            <strong>Applicant:</strong><br>
            {{ device?.applicant }}<br>
            {{ device?.contact }}<br>
            {{ device?.address }}
          </p>
          <p>
            <strong>Decision:</strong><br>
            {{ device?.decisionLabel }} ({{ device?.decision }})
          </p>
          <p>
            <strong>Date Received:</strong><br>
            {{ device?.dateReceived }}
          </p>
          <p>
            <strong>Decision Date:</strong><br>
            {{ device?.decisionDate }}
          </p>
          <p>
            <strong>Produce Code:</strong><br>
            {{ device?.productCode }}
          </p>

          <p>
            <strong>Summary/Statement:</strong><br>
            <a target="_blank" href="{{ device?.summaryStatementURL }}" [innerHTML]="device?.summaryStatementURL"></a>
          </p>
        </div>
      </div>

      <div class="card mt-5">
        <div class="card-header">Similar Devices</div>
        <div class="card-body">
          <table class="table table-sm">
            <thead>
              <tr>
                <th>510(k) Number</th>
                <th>Product Code</th>
                <th>Device Name</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of device?.similarDevices">
                <td><a [innerHTML]="item.knumber" [routerLink]="['/view/', item.knumber]"></a></td>
                <td>{{ item.productCode }}</td>
                <td>{{ item.deviceName }}</td>
              </tr>
            </tbody>
          </table>
          <p class="text-secondary small">Derived by finding the most similar device name embeddings.</p>
        </div>
      </div>

      <div class="card mt-5">
        <div class="card-header">Indications for use</div>
        <div class="card-body">
          <p [innerHTML]="device?.indicationsForUseAI"></p>

          <div *ngIf="!device?.indicationsForUseAI" class="text-end">
            <button (click)="extractIFU()" class="btn btn-primary">Extract with ChatGPT</button>
          </div>

          <div class="text-end text-secondary small" *ngIf="device?.indicationsForUseAI">From ChatGPT</div>
        </div>
      </div>

      <div class="card mt-5">
        <div class="card-header">Target Marketing Audience</div>
        <div class="card-body">
          <p [innerHTML]="device?.deviceMarketingAudience"></p>

          <div *ngIf="!device?.deviceMarketingAudience && !loadingMarketingAudience" class="text-end">
            <button (click)="getMarketingAudience()" class="btn btn-primary">Ask ChatGPT</button>
          </div>

          <div class="text-end text-secondary small" *ngIf="device?.deviceMarketingAudience">From ChatGPT</div>
        </div>
      </div>
    </div>
    <div class="col-4" *ngIf="productCodeDto">
      <div class="card">
        <div class="card-header">Product Code Details</div>
        <div class="card-body">
          <p>
            <strong>Produce Code:</strong><br>
            <a [innerHTML]="productCodeDto.productCode" [routerLink]="['/product-codes/', productCodeDto.productCode]"></a>
          </p>
          <p>
            <strong>Name:</strong><br>
            {{ productCodeDto.deviceName }}
          </p>
          <p>
            <strong>Class:</strong><br>
            {{ productCodeDto.deviceClass }}
          </p>
          <p>
            <strong>Regulation:</strong><br>
            {{ productCodeDto.regulationNumber }}
          </p>
          <p>
            <strong>Review Panel:</strong><br>
            {{ productCodeDto.reviewPanel }}
          </p>
        </div>
      </div>
      <div class="card mt-5" *ngIf="device?.relatedKNumbers">
        <div class="card-header">Related Submissions</div>
        <div class="card-body">
          <ul>
            <li *ngFor="let k of device?.relatedKNumbers">
              <a [routerLink]="['/view', k]" [innerHTML]="k"></a>
            </li>
          </ul>
          <p class="text-secondary small">These are the K numbers referenced in the statement or summary.</p>
        </div>
      </div>
    </div>
  </div>
</div>
